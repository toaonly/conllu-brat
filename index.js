!function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="./",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var r=function(){var t=function(){this.reset()};t.prototype.reset=function(){this.sentences=[],this.error=!1,this.logger=function(t){},this.strict=null},t.prototype.log=function(t){this.logger(t)},t.prototype.logError=function(t){this.log("error: "+t),this.error=!0},t.prototype.parse=function(t,n,s){this.reset(),void 0!==n&&(this.logger=n),void 0!==s&&(this.strict=s);var h=t.split("\n");null===this.strict&&(this.strict=o(t,this.logger));for(var d=a(t,this.logger,this.strict),u=[],p=[],c=!0,f=0;f<h.length;f++){var v=h[f],m=this,g=function(t){m.logError("line "+(f+1)+": "+t+' ("'+v+'")'),m.error=!0};if(l(v))c?p.push(v):g("comments must precede sentence, ignoring");else{c=!1;var y=d(v);if(0!==y.length){10!==y.length&&(g("expected 10 fields, got "+y.length),r(y,this.logger));for(var b=new i(y,f,v),S=b.validate(),E=0;E<S.length;E++)g(S[E]);0===S.length||b.repair(this.logger)?u.push(b):g("repair failed, discarding line")}else{if(0!==u.length){var D="S"+(this.sentences.length+1),_=new e(D,u,p);this.sentences.push(_)}else g("empty sentence, ignoring");u=[],p=[],c=!0}}}if(0!==u.length){this.strict&&this.logError("missing blank line after last sentence");D="S"+(this.sentences.length+1),_=new e(D,u,p);this.sentences.push(_),u=[],p=[],c=!0}return 0!==p.length&&this.logError("comments may not occur after last sentence, ignoring"),this},t.prototype.toBrat=function(t,e){void 0!==t&&(this.logger=t),void 0===e&&(e=!1);for(var i={},r=0,n=["entities","attributes","relations","comments","styles","sentlabels"],s=0;s<n.length;s++)i[n[s]]=[];i.text="";for(s=0;s<this.sentences.length;s++){for(var o=this.sentences[s],a=o.validate(),l=0;l<a.length;l++)this.logError(a[l]);if(0===a.length||o.repair(this.logger)){o.setBaseOffset(0!==r?r+1:0),bratData=o.toBrat(e),0!==i.text.length&&(i.text+="\n",r+=1),i.text+=bratData.text,r+=bratData.text.length;for(l=0;l<n.length;l++){var h=n[l];i[h]=i[h].concat(bratData[h])}}else this.logError("repair failed, discarding sentence")}return 0===i.text.length&&(i.text="<EMPTY>"),i.error=this.error,i};var e=function(t,e,i){this.id=t,this.elements=e,this.comments=i,this.baseOffset=0};e.prototype.setBaseOffset=function(t){this.baseOffset=t},e.prototype.dependencies=function(){for(var t=[],e=0;e<this.elements.length;e++){var i=this.elements[e];t=t.concat(i.dependencies())}return t},e.prototype.words=function(t){return this.elements.filter(function(e){return e.isWord()||t&&e.isEmptyNode()})},e.prototype.multiwords=function(){return this.elements.filter(function(t){return t.isMultiword()})},e.prototype.tokens=function(){for(var t=this.multiwords(),e={},i=0;i<t.length;i++)for(var r=t[i],n=r.rangeFrom();n<=r.rangeTo();n++)e[n]=!0;return this.elements.filter(function(t){return t.isToken(e)})},e.prototype.bratWords=function(t){for(var e=this.words(t),i=0;i<e.length;i++)u(e[i].form)&&(e[i]=c(e[i]),e[i].form=p(e[i].form));return e},e.prototype.bratTokens=function(){for(var t=this.tokens(),e=0;e<t.length;e++)t[e]=c(t[e]),t[e].form=p(t[e].form);return t},e.prototype.bratText=function(t){var e=this.bratWords(t),i=this.bratTokens(),r=e.map(function(t){return t.form}).join(" "),n=i.map(function(t){return t.form}).join(" "),s=r;return r!=n&&(s+="\n"+n),s},e.prototype.bratSpans=function(t){for(var e=[],i=this.baseOffset,r=this.bratWords(t),n=0;n<r.length;n++){var s=r[n].form.length;e.push([this.id+"-T"+r[n].id,r[n].upostag,[[i,i+s]]]),i+=s+1}return e},e.prototype.bratAttributes=function(t){for(var e=this.words(t),i=[],r=1,n=0;n<e.length;n++)for(var s=e[n],o=this.id+"-T"+s.id,a=s.features(),l=0;l<a.length;l++){var h=a[l][0],d=a[l][1];i.push([this.id+"-A"+r++,h,o,d])}return i},e.prototype.bratRelations=function(t){for(var e=this.dependencies(),i=[],r=0;r<e.length;r++){var n=e[r];i.push([this.id+"-R"+r,n[2],[["arg1",this.id+"-T"+n[1]],["arg2",this.id+"-T"+n[0]]]])}return i},e.prototype.bratComments=function(t){for(var e=this.words(t),i=[],r=0;r<e.length;r++){var n=e[r],s=this.id+"-T"+n.id,o="AnnotatorNotes";i.push([s,o,"Lemma: "+n.lemma]),"_"!==n.xpostag&&i.push([s,o,"Xpostag: "+n.xpostag]),"_"!==n.misc&&i.push([s,o,"Misc: "+n.misc])}return i},e.prototype.bratStyles=function(t){for(var e=[],i=[],r=0;r<this.comments.length;r++){var n=this.comments[r];if(m=n.match(/^(\#\s*visual-style\s+)(.*)/),m){var s=m[2];if(m=s.match(/^([^\t]+)\s+(\S+)\s*$/),m){var o=m[1],a=m[2];m=a.match(/^(\S+):(\S+)$/),m?(h=m[1],d=m[2]):(d=a,h="arcs"===o||-1!==o.indexOf(" ")?"color":"bgColor"),o.match(/^(nodes|arcs)$/)?i.push([o,h,d]):(-1===o.indexOf(" ")?o=this.id+"-T"+o:((o=o.split(" "))[0]=this.id+"-T"+o[0],o[1]=this.id+"-T"+o[1]),e.push([o,h,d]))}else console.log('warning: failed to parse: "'+n+'"')}}var l={};for(r=0;r<e.length;r++)l[e[r][0].concat([e[r][1]])]=!0;for(r=0;r<i.length;r++){o=i[r][0];var h=i[r][1],d=i[r][2];if("nodes"===o)for(var u=this.words(t),p=0;p<u.length;p++){l[(f=this.id+"-T"+u[p].id).concat([h])]||(e.push([f,h,d]),l[f.concat([h])]=!0)}else if("arcs"===o){var c=this.dependencies();for(p=0;p<c.length;p++){var f;l[(f=[this.id+"-T"+c[p][1],this.id+"-T"+c[p][0],c[p][2]]).concat([h])]||(e.push([f,h,d]),l[f.concat([h])]=!0)}}else console.log("internal error")}return e},e.prototype.bratLabel=function(){for(var t=null,e=0;e<this.comments.length;e++){var i=this.comments[e];m=i.match(/^(\#\s*sentence-label\b)(.*)/),m&&(t=m[2].trim())}return t},e.prototype.toBrat=function(t){return{text:this.bratText(t),entities:this.bratSpans(t),attributes:this.bratAttributes(t),relations:this.bratRelations(t),comments:this.bratComments(t),styles:this.bratStyles(t),sentlabels:[this.bratLabel()]}},e.prototype.elementById=function(){for(var t={},e=0;e<this.elements.length;e++)t[this.elements[e].id]=this.elements[e];return t},e.prototype.addError=function(t,e,i){i.push("line "+(e.lineidx+1)+": "+t+' ("'+e.line+'")')},e.prototype.validate=function(){var t=[];return this.validateUniqueIds(t),this.validateWordSequence(t),this.validateMultiwordSequence(t),this.validateEmptyNodeSequence(t),this.validateReferences(t),t},e.prototype.validateUniqueIds=function(t){for(var e=(t=void 0!==t?t:[]).length,i={},r=0;r<this.elements.length;r++){var n=this.elements[r];void 0!==i[n.id]&&this.addError('non-unique ID "'+n.id+'"',n,t),i[n.id]=n}return t.length===e},e.prototype.validateWordSequence=function(t){for(var e=(t=void 0!==t?t:[]).length,i=1,r=0;r<this.elements.length;r++){var n=this.elements[r];n.isMultiword()||n.isEmptyNode()||(parseInt(n.id,10)!==i&&this.addError("word IDs should be 1,2,3,..., expected "+i+", got "+n.id,n,t),i=parseInt(n.id,10)+1)}return t.length===e},e.prototype.validateMultiwordSequence=function(t){for(var e=(t=void 0!==t?t:[]).length,i=1,r=0;r<this.elements.length;r++){var n=this.elements[r];n.isMultiword()&&n.rangeFrom()!==i?this.addError("multiword tokens must appear before first word in their range",n,t):i=parseInt(n.id,10)+1}return t.length===e},e.prototype.validateEmptyNodeSequence=function(t){for(var e=(t=void 0!==t?t:[]).length,i="0",r=1,n=0;n<this.elements.length;n++){var s=this.elements[n];if(s.isWord())i=s.id,r=1;else if(s.isEmptyNode()){var o=i+"."+r;s.id!==o&&this.addError("empty node IDs should be *.1, *.2, ... expected "+o+", got "+s.id,s,t),r++}}return t.length===e},e.prototype.validateReferences=function(t){for(var e=(t=void 0!==t?t:[]).length,i=this.elementById(),r=0;r<this.elements.length;r++){var n=this.elements[r];n.validHeadReference(i)||this.addError('HEAD is not valid ID: "'+n.head+'"',n,t);for(var s=n.dependencies(!0),o=0;o<s.length;o++){var a=s[o][1];"0"!==a&&void 0===i[a]&&this.addError('invalid ID "'+a+'" in DEPS',n,t)}}return t.length===e},e.prototype.repair=function(t){return t=void 0!==t?t:d,this.validateUniqueIds()||this.repairUniqueIds(t),this.validateWordSequence()||this.repairWordSequence(t),this.validateMultiwordSequence()||this.repairMultiwordSequence(t),this.validateEmptyNodeSequence()||this.repairEmptyNodeSequence(t),this.validateReferences()||this.repairReferences(t),0===this.validate().length},e.prototype.repairUniqueIds=function(t){t=void 0!==t?t:d;for(var e={},i=[],r=0;r<this.elements.length;r++){var n=this.elements[r];void 0===e[n.id]?(e[n.id]=n,i.push(n)):t('repair: remove element with duplicate ID "'+n.id+'"')}return this.elements=i,!0},e.prototype.repairWordSequence=function(t){return t("TODO: implement ConllU.Sentence.repairWordSequence()"),!0},e.prototype.repairMultiwordSequence=function(t){return t("TODO: implement ConllU.Sentence.repairMultiwordSequence()"),!0},e.prototype.repairEmptyNodeSequence=function(t){return t("TODO: implement ConllU.Sentence.repairEmptyNodeSequence()"),!0},e.prototype.repairReferences=function(t){t=void 0!==t?t:d;for(var e=this.elementById(),i=0;i<this.elements.length;i++){var r=this.elements[i];if(r.validHeadReference(e)||(t("repair: blanking invalid HEAD"),r.head=null),"_"!==r.deps){for(var n=r.deps.split("|"),s=[],o=0;o<n.length;o++){var a=n[o],l=a.match(g);if(l){var h=l[1];l[2];"0"===h||void 0!==e[h]?s.push(a):(t("repair: removing invalid ID from DEPS"),error=!0)}else console.log("internal error: repairReferences(): invalid DEPS")}0===s.length?r.deps="_":r.deps=s.join("|")}}return!0};var i=function(t,e,i){this.id=t[0],this.form=t[1],this.lemma=t[2],this.upostag=t[3],this.xpostag=t[4],this.feats=t[5],this.head=t[6],this.deprel=t[7],this.deps=t[8],this.misc=t[9],this.lineidx=e,this.line=i};i.prototype.validateField=function(t,e,i,r){return e=void 0!==e?e:"field",i=void 0!==i?i:[],void 0===r&&(r=!1),void 0===t?(i.push("invalid "+e),!1):0===t.length?(i.push(e+' must not be empty: "'+t+'"'),!1):!(h(t)&&!r)||(i.push(e+' must not contain space: "'+t+'"'),!1)},i.prototype.validateId=function(t,e){if(e=void 0!==e?e:[],this.validateField(t,"ID",e)){if(t.match(/^\d+$/))return"0"!==t||(e.push('ID indices must start from 1: "'+t+'"'),!1);if(t.match(/^(\d+)-(\d+)$/)){if(m=t.match(/^(\d+)-(\d+)$/),!m)return console.log("internal error"),!1;var i=parseInt(m[1],10);return!(parseInt(m[2],10)<i)||(e.push('ID ranges must have start <= end: "'+t+'"'),!1)}if(t.match(/^(\d+)\.(\d+)$/)){if(m=t.match(/^(\d+)\.(\d+)$/),!m)return console.log("internal error"),!1;var r=parseInt(m[1],10),n=parseInt(m[2],10);return 0!=r&&0!=n||(e.push('ID indices must start from 1: "'+t+'"'),!1)}return e.push('ID must be integer, range, or decimal: "'+t+'"'),!1}return!1},i.prototype.validateForm=function(t,e){return e=void 0!==e?e:[],!!this.validateField(t,"FORM",e,!0)},i.prototype.validateLemma=function(t,e){return e=void 0!==e?e:[],!!this.validateField(t,"LEMMA",e,!0)},i.prototype.validateUpostag=function(t,e){return e=void 0!==e?e:[],!!this.validateField(t,"UPOSTAG",e)},i.prototype.validateXpostag=function(t,e){return e=void 0!==e?e:[],!!this.validateField(t,"XPOSTAG",e)},i.prototype.validateFeats=function(t,e){if(e=void 0!==e?e:[],!this.validateField(t,"FEATS",e))return!1;if("_"===t)return!0;for(var i=e.length,r=t.split("|"),n={},s=null,o=0;o<r.length;o++){var a=r[o];if(m=a.match(f)){var l=m[1],h=m[2];null!==s&&l.toLowerCase()<s.toLowerCase()&&(e.push('features must be ordered alphabetically (case-insensitive): "'+l+'" < "'+s+'"'),noIssue=!1),s=l;for(var d=h.split(","),u={},p=[],c=0;c<d.length;c++){var m,g=d[c];(m=g.match(v))?void 0===u[g]?(u[g]=!0,p.push(g)):e.push('duplicate feature value: "'+g+'"'):e.push('invalid FEATS value: "'+g+'"')}void 0===n[l]?0!==p.length&&(n[l]=p):e.push('duplicate feature name: "'+l+'"')}else e.push('invalid FEATS entry: "'+a+'"')}return e.length===i},i.prototype.validateHead=function(t,e){return e=void 0!==e?e:[],null===t||!!this.validateField(t,"HEAD",e)&&(!(!this.isEmptyNode()||"_"!==t)||(!!t.match(/^\d+$/)||(e.push('HEAD must be an ID or zero: "'+t+'"'),!1)))},i.prototype.validateDeprel=function(t,e){return e=void 0!==e?e:[],!!this.validateField(t,"DEPREL",e)},i.prototype.validateDeps=function(t,e){if(e=void 0!==e?e:[],!this.validateField(t,"DEPS",e))return!1;if("_"===t)return!0;for(var i=t.split("|"),r=null,n=0;n<i.length;n++){var s=i[n];if(m=s.match(/^(\d+(?:\.\d+)?):(\S+)$/),!m)return e.push('invalid DEPS: "'+t+'"'),!1;var o=m[1];m[2];if(null!==r&&parseFloat(o)<parseFloat(r))return e.push("DEPS must be ordered by head index"),!1;r=o}return!0},i.prototype.validateMisc=function(t,e){return e=void 0!==e?e:[],!!this.validateField(t,"MISC",e)},i.prototype.validHeadReference=function(t){return"_"===this.head||null===this.head||"0"===this.head||void 0!==t[this.head]},i.prototype.isWord=function(){return!!this.id.match(/^\d+$/)},i.prototype.isMultiword=function(){return!!this.id.match(/^\d+-\d+$/)},i.prototype.isEmptyNode=function(){return!!this.id.match(/^\d+\.\d+$/)},i.prototype.rangeFrom=function(){return parseInt(this.id.match(/^(\d+)-\d+$/)[1],10)},i.prototype.rangeTo=function(){return parseInt(this.id.match(/^\d+-(\d+)$/)[1],10)},i.prototype.isToken=function(t){return this.isMultiword()||!t[this.id]},i.prototype.dependencies=function(t){var e=[];if((t=void 0!==t&&t)||"_"===this.head||null===this.head||e.push([this.id,this.head,this.deprel]),"_"!=this.deps)for(var i=this.deps.split("|"),r=0;r<i.length;r++){var n=i[r];m=n.match(g),m?e.push([this.id,m[1],m[2]]):console.log("internal error: dependencies(): invalid DEPS",this.deps)}return e},i.prototype.features=function(){var t=[];if("_"===this.feats)return[];for(var e=this.feats.split("|"),i=0;i<e.length;i++){if(o=e[i].match(f))for(var r=o[1],n=o[2].split(","),s=0;s<n.length;s++){var o,a=n[s];(o=a.match(v))&&t.push([r,a])}}return t},i.prototype.validate=function(){var t=[];return this.validateId(this.id,t),this.validateForm(this.form,t),this.isMultiword()?("_"==this.lemma&&"_"==this.upostag&&"_"==this.xpostag&&"_"==this.feats&&"_"==this.head&&"_"==this.deprel&&"_"==this.deps&&"_"==this.misc||t.push("non-underscore field for multiword token"),t):(this.validateLemma(this.lemma,t),this.validateUpostag(this.upostag,t),this.validateXpostag(this.xpostag,t),this.validateFeats(this.feats,t),this.validateHead(this.head,t),this.validateDeprel(this.deprel,t),this.validateDeps(this.deps,t),this.validateMisc(this.misc,t),t)},i.prototype.repair=function(t){return t=void 0!==t?t:d,!!this.validateId(this.id)&&(this.validateForm(this.form)||(t("repair: blanking invalid FORM"),this.form="<ERROR>"),this.isMultiword()?(this.lemma="_",this.upostag="_",this.xpostag="_",this.feats="_",this.head="_",this.deprel="_",this.deps="_",this.misc="_",!0):(this.validateLemma(this.lemma)||(t("repair: blanking invalid LEMMA"),this.lemma="<ERROR>"),this.validateUpostag(this.upostag)||(t("repair: blanking invalid UPOSTAG"),this.upostag="_"),this.validateXpostag(this.xpostag)||(t("repair: blanking invalid XPOSTAG"),this.xpostag="_"),this.validateFeats(this.feats)||(t("repair: blanking invalid FEATS"),this.feats="_"),this.validateHead(this.head)||(t("repair: blanking invalid HEAD"),this.head=null),this.validateDeprel(this.deprel)||(t("repair: blanking invalid DEPREL"),this.deprel="_"),this.validateDeps(this.deps)||(t("repair: blanking invalid DEPS"),this.deps="_"),this.validateMisc(this.misc)||(t("repair: blanking invalid MISC"),this.misc="_"),0===this.validate().length))};var r=function(t,e){if(void 0===e&&(e=d),t.length>10)e("repair: discarding fields > 10"),t=t.slice(0,10);else{e('repair: filling in empty ("_") for missing fields');for(var i=0;i<10-t.length;i++)t.push("_")}},n=function(t){return 0===t.length?[]:t.split("\t")},s=function(t){return 0===(t=t.trim()).length?[]:t.split(/\s+/)},o=function(t,e){return-1!==t.indexOf("\t")?(e("note: TAB found, parsing CoNLL-U in strict mode."),!0):(e("note: no TAB found, parsing CoNLL-U in loose mode."),!1)},a=function(t,e,i){return i?n:s},l=function(t){return 0!==t.length&&"#"===t[0]},h=function(t){return!!t.match(/\s/)},d=function(t){return null},u=function(t){return!!t.match(/^[\u0591-\u07FF\uFB1D-\uFDFD\uFE70-\uFEFC]+$/)},p=function(t){return u(t)&&(t="ˑ"+t+"ˑ"),t},c=function(t){return JSON.parse(JSON.stringify(t))},f=/^([A-Z0-9][a-zA-Z0-9]*(?:\[[a-z0-9]+\])?)=([A-Z0-9][a-zA-Z0-9]*(?:,[A-Z0-9][a-zA-Z0-9]*)*)$/,v=/^[A-Z0-9][a-zA-Z0-9]*$/,g=/^(\d+(?:\.\d+)?):(.*)$/;return{Document:t,Sentence:e,Element:i}}();e.default=r}]);